## Методы жизненного цикла, propTypes, defaultProps

### propTypes

Для работы с функционалом необходимо установить npm пакет `prop-types`. Раньше этот функционал был встроен в сам Реакт, сейчас его вынесли в отдельную библиотеку.
   
`propTypes` - это Runtime проверка типов данных, которые приходят в наши компоненты.

Есть два способа задать `propTypes` для классового компонента:
 - в виде статического свойства класса `static propTypes = { ... }` внутри самого класса. Такой подход работает только в классовых компонентах, поэтому лучше исопльзовать второй вариант
 - прописать после класса `Email.propTypes = { ... }` - такой подход будет работать и в классовом, и в функциональном компоненте, поэтому рекомендуется использовать именно такой синтаксис

Пример кода:

```js
import PropTypes from 'prop-types';

...

Email.propTypes = {
  email: PropTypes.object.isRequired,
}
```
   
При несовпадении любого из условий `propTypes` мы увидим предупреждение в консоли.

Фунционал `propTypes` поддерживает следующие типы данных:
 - string (строки)
 - bool (булевые выражения)
 - func (функции)
 - object (объекты)
 - array (массивы)
 - symbol (тип данных Symbol)
 - number (числа)
   
Также мы можем использовать следующие функции:
 - oneOfType - внутрь передается массив PropTypes, позволяет указать, что свойство компонента может быть одним из нескольких типов
 - oneOf - внутрь передается массив элементов любого типа, позволяет указать, что значение должно являться одним из предоставленного списка
 - arrayOf - внутрь передается элемент PropTypes, позволяет указать, что на вход должен прийти массив элементов данного типа
 - instanceOf - проверяет, является ли свойство объектом определенного класса
 - shape - позволяет укзаать, какие поля должны содержаться в передаваемом объекте и их тип
 - exact - позволяет строго сформировать структуру объекта, который должен быть передан в качестве свойства
   
Ключевое слово `.isRequired` позволяет указать, что данное свойство является обязательным, и без него наш компонент не сможет нормально работать.

### defaultProps

Фунционал `defaultProps` позволяет указать значение по умолчанию для свойств, которые не были переданы в наш компонент, но которые он может принимать.

**ВАЖНО!!!** Если в качестве значения свойства передать `null`, `defaultProps` не применится. `defaultProps` применяется только если свойство не было передано, или мы явно передали `undefined`.

Аналогично с `propTypes`, существует два способа задания `defaultProps` для классового компонента - в виде статического свойства класса, и указание его после объявления класса. Второй способ является предпочтительным.
   
Существует соглашение, что `defaultProps` обязательно надо прописывать для всех свойств, которые не вляются обязательными в компоненте (то етсь для которых `propTypes` не стоит `isRequired`). Современные линтеры автоматически это проверяют.

### Жизненный цикл компонента

Основные методы жизненного цикла компонента: https://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/
   
Три основные этапа - Монтирование (выполняется один раз), Обновление (каждый перерендер), Размонтирование (один раз).

 - `constructor()` - выполняется один раз, при инициализации компонента
 - `render()` - выводит содержимое компонента на экран. Может выполлняться много раз
 - `componentDidMount()` - выполняется один раз, когда компонент был первый раз отрендерен. Используется для получения данных с сервера, инициализации каких-то переменных или глобальных слушателей
 - `componentDidUpdate()` - выполняется каждый раз, когда в компонента что-то меняется - state или props. Используется для повторных запросов на сервер или обновлений, когда у нас что-то поменялось, но мы находимся в этом же компоненте (например, мы находися на странице со списком имейлов, и в блоке пагинации нажимаем переход на следующую страницу)
 - `componentWillUnmount()` - выполняется один раз, прежде чем компонент будет удален с экрана. Используется для очистки каких-то глобальных ресурсов. Например, если в componentDidMount мы поставили какой-то глобальный слушатель на весь наш объект document, в componentWillUnmount мы должны этот слушатель убрать чтобы не происходило утечек памяти в приложении 
 - `componentShouldUpdate` и функция `this.forceUpdate()` - позволяют руками указать, когда надо или не надо перерендерить компонент. В 99% случаев не нужны. Надо максимально стараться избегать их использования.
   
### ErrorBoundary и перехват ошибок рендеринга в приложении
   
Для перехвата ошибок рендеринга используются методы `componendDidCatch()` и `static getDerivedStateFromError()`. Они отлавливают ошибки рендеринга в **дочерних** компонентах.
   
Чтобы иметь возможность перехватывать ошибки во всем приложении, обычно содается отдельный компонент `ErrorBoundary` на самом верхнем уровне, в него оборачиваются все остальные компоненты.
   
```js
<ErrorBoundary>
  <App />
</ErrorBoundary>
```
   
В режиме разработки, мы все равно через секунду видим техническую ошибку, когда она возникает. Но это работает только в режиме разработки, а в собранной и задеплоенной версии пользователь увидит только сверстанную страницу с ошибкой.
